<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Caregiver Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensuring custom checkbox styles are applied correctly with Tailwind */
        input[type="checkbox"].form-checkbox {
            appearance: none; /* Remove default browser styling */
            background-color: #fff;
            border: 2px solid #94a3b8; /* gray-400, slightly thicker border */
            border-radius: 0.25rem; /* rounded-md */
            display: inline-block;
            position: relative;
            cursor: pointer;
            flex-shrink: 0; /* Prevent shrinking in flex container */
            /* Size is now controlled by Tailwind classes h-8 w-8 */
            /* Ensure vertical alignment if needed */
             vertical-align: middle;
        }
        input[type="checkbox"].form-checkbox:checked {
            background-color: #0D9488; /* teal-600 */
            border-color: #0D9488; /* teal-600 */
        }
        /* Style for the checkmark inside the box */
        input[type="checkbox"].form-checkbox:checked::after {
            content: 'âœ”';
            /* Adjusted font-size and weight for the larger box */
            font-size: 1.25rem; /* 20px */
            font-weight: bold;
            color: white;
            position: absolute;
            left: 50%;
            top: 50%;
            /* Centering the checkmark */
            transform: translate(-50%, -50%);
            line-height: 1; /* Ensure consistent line height */
        }
        /* Accordion styles */
        .accordion-header {
            cursor: pointer;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 2000px; /* Adjust as needed */
        }
        #logoUpload {
            display: none; /* Hide the default file input */
        }
        #logoDisplayContainer {
            cursor: pointer;
        }
        .custom-task-input-area {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        .instructions ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        .instructions li {
            margin-bottom: 0.25rem;
        }
        /* Add some margin to the checkbox cell for better spacing */
        .checkbox-cell {
            padding-right: 0.5rem; /* Add some space between checkbox and label */
        }
    </style>
</head>
<body class="bg-slate-100 text-gray-800 p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <div class="mb-6 p-4 bg-teal-50 border border-teal-200 rounded-lg shadow instructions">
            <h2 class="text-lg font-semibold text-teal-700 mb-2">How to Use This Checklist:</h2>
            <ul class="text-sm text-teal-600">
                <li>Click on a section header (e.g., "Personal Care") to expand or collapse its tasks.</li>
                <li>Check the box next to tasks you perform.</li>
                <li>For each selected task, you can optionally note "Who can help?" and "When/How often?".</li>
                <li>Click the placeholder logo area at the top to upload your own logo.</li>
                <li>In the "Other (Custom Tasks)" section, click "Add Custom Task" to create an input field for new items.</li>
                <li>Once you've customized your list, use the buttons at the bottom to export it as a PDF, Word document, or Excel CSV file.</li>
            </ul>
        </div>

        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl">
            <header class="text-center mb-8">
                <div id="logoDisplayContainer" class="mx-auto mb-4 w-24 h-24 rounded-full overflow-hidden border-2 border-gray-300 hover:border-teal-400 flex items-center justify-center transition-colors" title="Click to upload logo">
                    <img id="logoDisplay" src="https://placehold.co/100x100/CCFBF1/0D9488?text=CG" alt="Logo" class="w-full h-full object-cover">
                </div>
                <input type="file" id="logoUpload" accept="image/*">

                <h1 class="text-3xl md:text-4xl font-bold text-teal-700">Caregiver Checklist</h1>
                <p class="text-gray-600 mt-2">Identify and prioritize the support you need. Mark tasks, note who can help, and how often.</p>
            </header>

            <main id="checklistContainer" class="space-y-6">
                </main>

            <div class="mt-8 pt-6 border-t border-gray-300 export-buttons text-center">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Export Your Checklist</h2>
                <button id="exportPdf" class="bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-4 rounded-md shadow transition-colors">Export to PDF</button>
                <button id="exportDoc" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md shadow transition-colors">Export to Word (.doc)</button>
                <button id="exportCsv" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-md shadow transition-colors">Export to Excel (.csv)</button>
            </div>
        </div>
    </div>

    <script>
        // Checklist data based on the PDF
        const checklistData = [
             {
                section: "Personal Care",
                items: [
                    "Bathing", "Dressing", "Eating/feeding", "Foot care", "Mouth care",
                    "Toileting", "Lifting/transferring", "Grooming (shaving, hair care)"
                ]
            },
            {
                section: "Help Around the House",
                items: [
                    "Light housekeeping (sweeping, dusting, meal clean up)",
                    "Cleaning bathroom and floors", "Laundry", "Meal planning",
                    "Meal preparation", "Gardening", "Snow shoveling",
                    "Care for pets/plants", "Check mail", "Sort recycling/waste disposal"
                ]
            },
            {
                section: "Transportation/Shopping",
                items: [
                    "Coordinating care", "Drive family/friend to appointments",
                    "Drive family/friend to activities/social appointments",
                    "Take family/friend shopping", "Fill prescriptions", "Car maintenance"
                ]
            },
            {
                section: "Psycho-Social Support",
                items: [
                    "Check-in by phone or text", "In-person visits", "Leisure activities"
                ]
            },
            {
                section: "Financial/Legal Affairs",
                items: [
                    "Banking, pay bills", "Legal documents", "Income taxes"
                ]
            },
            {
                section: "Other (Custom Tasks)",
                items: [], // Start with no predefined custom tasks
                custom: true // Flag to identify this section for adding tasks
            }
        ];

        const checklistContainer = document.getElementById('checklistContainer');
        const logoUploadInput = document.getElementById('logoUpload');
        const logoDisplay = document.getElementById('logoDisplay');
        const logoDisplayContainer = document.getElementById('logoDisplayContainer');

        // Handle logo upload
        logoDisplayContainer.addEventListener('click', () => logoUploadInput.click());
        logoUploadInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoDisplay.src = e.target.result;
                }
                reader.readAsDataURL(file);
            } else if (file) {
                alert("Please select a valid image file (e.g., JPG, PNG, GIF).");
            }
        });

        // Function to render the checklist
        function renderChecklist() {
            checklistContainer.innerHTML = ''; // Clear existing content

            checklistData.forEach((sectionData, sectionIndex) => {
                const sectionId = `section-${sectionIndex}`;
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'bg-white p-0 rounded-lg shadow-md';

                // Accordion Header
                const headerDiv = document.createElement('div');
                headerDiv.className = 'accordion-header flex justify-between items-center p-3 rounded-t-md bg-teal-100 hover:bg-teal-200 transition-colors';
                headerDiv.innerHTML = `<h2 class="text-xl font-semibold text-teal-700">${sectionData.section}</h2>
                                       <span class="transform transition-transform duration-300 text-xl text-teal-600">&#9660;</span>`; // Down arrow

                // Accordion Content
                const contentDiv = document.createElement('div');
                contentDiv.id = sectionId + '-content';
                contentDiv.className = 'accordion-content p-4 border border-t-0 border-teal-200 rounded-b-md';

                // Table for tasks
                const table = document.createElement('table');
                table.className = 'w-full text-sm';
                const a_thead = table.createTHead();
                a_thead.className = 'hidden md:table-header-group';
                const headerRow = a_thead.insertRow();
                headerRow.innerHTML = `
                    <th class="text-left p-2 font-semibold text-gray-700">Perform?</th>
                    <th class="text-left p-2 font-semibold text-gray-700">Activity</th>
                    <th class="text-left p-2 font-semibold text-gray-700">Who can help?</th>
                    <th class="text-left p-2 font-semibold text-gray-700">When/How often?</th>
                    ${sectionData.custom ? '<th class="text-left p-2 font-semibold text-gray-700">Action</th>' : ''}
                `;

                const tbody = table.createTBody();
                tbody.id = `tbody-${sectionIndex}`;

                sectionData.items.forEach((item, itemIndex) => {
                    const row = tbody.insertRow();
                    row.className = 'task-item-row border-b border-gray-200 last:border-b-0 flex flex-col md:table-row hover:bg-gray-50 transition-colors';

                    const performCell = row.insertCell();
                    // Added checkbox-cell class for padding
                    performCell.className = 'p-2 md:w-auto flex items-center checkbox-cell'; // Use md:w-auto for checkbox column
                    // *** UPDATED CHECKBOX SIZE HERE ***
                    performCell.innerHTML = `<input type="checkbox" id="task-${sectionIndex}-${itemIndex}" data-section-index="${sectionIndex}" data-item-index="${itemIndex}" data-section="${sectionData.section}" data-item="${item}" class="form-checkbox h-8 w-8 text-teal-600 rounded border-gray-300 focus:ring-teal-500">`;

                    const activityCell = row.insertCell();
                    // Adjusted width slightly
                    activityCell.className = 'p-2 md:w-4/12 flex items-center'; // Use flex items-center for vertical alignment with larger checkbox
                    activityCell.innerHTML = `<label for="task-${sectionIndex}-${itemIndex}" class="cursor-pointer block text-gray-700"><strong class="md:hidden text-gray-600">Activity: </strong>${item}</label>`;

                    const helpCell = row.insertCell();
                    helpCell.className = 'p-2 md:w-3/12';
                    helpCell.innerHTML = `<label class="block text-xs text-gray-500 md:hidden mb-1">Who can help?</label><input type="text" placeholder="e.g., Family, Friend" class="form-input w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-200 focus:ring-opacity-50" data-input="help">`;

                    const whenCell = row.insertCell();
                    whenCell.className = 'p-2 md:w-3/12';
                    whenCell.innerHTML = `<label class="block text-xs text-gray-500 md:hidden mb-1">When/How often?</label><input type="text" placeholder="e.g., Daily, Weekly" class="form-input w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-200 focus:ring-opacity-50" data-input="when">`;

                    if (sectionData.custom) {
                        const actionCell = row.insertCell();
                        // Adjusted width slightly
                        actionCell.className = 'p-2 md:w-1/12 text-right md:text-left';
                        actionCell.innerHTML = `<button class="remove-task-btn bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs font-medium transition-colors" data-section-index="${sectionIndex}" data-item-index="${itemIndex}">Remove</button>`;
                    }
                });
                contentDiv.appendChild(table);

                if (sectionData.custom) {
                    const addTaskArea = document.createElement('div');
                    addTaskArea.id = `add-task-area-${sectionIndex}`;
                    addTaskArea.className = "mt-4";

                    const addTaskButton = document.createElement('button');
                    addTaskButton.textContent = 'Add Custom Task';
                    addTaskButton.className = 'add-task-btn bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors';
                    addTaskButton.onclick = () => showCustomTaskInput(sectionIndex);

                    addTaskArea.appendChild(addTaskButton);
                    contentDiv.appendChild(addTaskArea);
                }

                sectionDiv.appendChild(headerDiv);
                sectionDiv.appendChild(contentDiv);
                checklistContainer.appendChild(sectionDiv);

                // Accordion functionality
                headerDiv.addEventListener('click', () => {
                    contentDiv.classList.toggle('open');
                    const arrow = headerDiv.querySelector('span');
                    if (contentDiv.classList.contains('open')) {
                        arrow.innerHTML = '&#9650;'; // Up arrow
                        arrow.classList.add('rotate-180');
                    } else {
                        arrow.innerHTML = '&#9660;'; // Down arrow
                        arrow.classList.remove('rotate-180');
                    }
                });
            });

            attachRemoveButtonListeners();
        }

        function attachRemoveButtonListeners() {
            document.querySelectorAll('.remove-task-btn').forEach(button => {
                button.replaceWith(button.cloneNode(true));
            });
            document.querySelectorAll('.remove-task-btn').forEach(button => {
                 button.addEventListener('click', function() {
                    const sectionIdx = parseInt(this.dataset.sectionIndex);
                    const itemIdx = parseInt(this.dataset.itemIndex);
                    removeCustomTask(sectionIdx, itemIdx);
                });
            });
        }

        function showCustomTaskInput(sectionIndex) {
            const addTaskArea = document.getElementById(`add-task-area-${sectionIndex}`);
            if (!addTaskArea) return;

            const addButton = addTaskArea.querySelector('.add-task-btn');
            if (addButton) addButton.style.display = 'none';

            if (addTaskArea.querySelector('.custom-task-input-area')) return;

            const inputGroup = document.createElement('div');
            inputGroup.className = 'custom-task-input-area';

            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.placeholder = 'Enter new task name';
            inputField.className = 'form-input flex-grow rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-200 focus:ring-opacity-50';

            const saveButton = document.createElement('button');
            saveButton.textContent = 'Save Task';
            saveButton.className = 'save-custom-task-btn bg-teal-500 hover:bg-teal-600 text-white px-3 py-1.5 rounded-md text-sm font-medium transition-colors';
            saveButton.onclick = () => {
                const taskName = inputField.value.trim();
                if (taskName) {
                    addCustomTaskToList(sectionIndex, taskName);
                    inputGroup.remove();
                    if (addButton) addButton.style.display = 'inline-block';
                } else {
                    alert("Task name cannot be empty.");
                }
            };

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.className = 'bg-gray-400 hover:bg-gray-500 text-gray-800 px-3 py-1.5 rounded-md text-sm font-medium transition-colors';
            cancelButton.onclick = () => {
                inputGroup.remove();
                if (addButton) addButton.style.display = 'inline-block';
            };

            inputGroup.appendChild(inputField);
            inputGroup.appendChild(saveButton);
            inputGroup.appendChild(cancelButton);
            addTaskArea.appendChild(inputGroup);
            inputField.focus();
        }

        function addCustomTaskToList(sectionIndex, taskName) {
            checklistData[sectionIndex].items.push(taskName);

            const tbody = document.getElementById(`tbody-${sectionIndex}`);
            const itemIndex = checklistData[sectionIndex].items.length - 1;
            const item = taskName;
            const sectionData = checklistData[sectionIndex];

            const row = tbody.insertRow();
            row.className = 'task-item-row border-b border-gray-200 last:border-b-0 flex flex-col md:table-row hover:bg-gray-50 transition-colors';

            const performCell = row.insertCell();
            performCell.className = 'p-2 md:w-auto flex items-center checkbox-cell';
             // *** UPDATED CHECKBOX SIZE HERE ***
            performCell.innerHTML = `<input type="checkbox" id="task-${sectionIndex}-${itemIndex}" data-section-index="${sectionIndex}" data-item-index="${itemIndex}" data-section="${sectionData.section}" data-item="${item}" class="form-checkbox h-8 w-8 text-teal-600 rounded border-gray-300 focus:ring-teal-500">`;

            const activityCell = row.insertCell();
            activityCell.className = 'p-2 md:w-4/12 flex items-center';
            activityCell.innerHTML = `<label for="task-${sectionIndex}-${itemIndex}" class="cursor-pointer block text-gray-700"><strong class="md:hidden text-gray-600">Activity: </strong>${item}</label>`;

            const helpCell = row.insertCell();
            helpCell.className = 'p-2 md:w-3/12';
            helpCell.innerHTML = `<label class="block text-xs text-gray-500 md:hidden mb-1">Who can help?</label><input type="text" placeholder="e.g., Family, Friend" class="form-input w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-200 focus:ring-opacity-50" data-input="help">`;

            const whenCell = row.insertCell();
            whenCell.className = 'p-2 md:w-3/12';
            whenCell.innerHTML = `<label class="block text-xs text-gray-500 md:hidden mb-1">When/How often?</label><input type="text" placeholder="e.g., Daily, Weekly" class="form-input w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-200 focus:ring-opacity-50" data-input="when">`;

            const actionCell = row.insertCell();
            actionCell.className = 'p-2 md:w-1/12 text-right md:text-left';
            actionCell.innerHTML = `<button class="remove-task-btn bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs font-medium transition-colors" data-section-index="${sectionIndex}" data-item-index="${itemIndex}">Remove</button>`;

            actionCell.querySelector('.remove-task-btn').addEventListener('click', function() {
                removeCustomTask(sectionIndex, itemIndex);
            });

            const contentDiv = document.getElementById(`section-${sectionIndex}-content`);
            if (contentDiv && !contentDiv.classList.contains('open')) {
                contentDiv.classList.add('open');
                const arrow = contentDiv.previousElementSibling.querySelector('span');
                if(arrow) {
                    arrow.innerHTML = '&#9650;';
                    arrow.classList.add('rotate-180');
                }
            }
        }

        function removeCustomTask(sectionIndex, itemIndex) {
            if (confirm(`Are you sure you want to remove the task: "${checklistData[sectionIndex].items[itemIndex]}"?`)) {
                checklistData[sectionIndex].items.splice(itemIndex, 1);
                renderChecklist();

                const sectionContent = document.getElementById(`section-${sectionIndex}-content`);
                if (sectionContent) {
                    sectionContent.classList.add('open');
                     const arrow = sectionContent.previousElementSibling.querySelector('span');
                    if(arrow) {
                        arrow.innerHTML = '&#9650;';
                        arrow.classList.add('rotate-180');
                    }
                }
            }
        }

        function getSelectedItems() {
            const selected = [];
            document.querySelectorAll('input[type="checkbox"].form-checkbox').forEach(checkbox => {
                if (checkbox.checked) {
                    const taskRow = checkbox.closest('.task-item-row');
                    const helpInput = taskRow.querySelector('input[data-input="help"]');
                    const whenInput = taskRow.querySelector('input[data-input="when"]');

                    selected.push({
                        section: checkbox.dataset.section,
                        activity: checkbox.dataset.item,
                        help: helpInput ? helpInput.value : '',
                        when: whenInput ? whenInput.value : ''
                    });
                }
            });
            return selected;
        }

        // Export to PDF
        document.getElementById('exportPdf').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const selectedItems = getSelectedItems();

            if (selectedItems.length === 0) {
                alert("No items selected to export.");
                return;
            }

            let logoDataUrl = null;
            if (logoDisplay.src && logoDisplay.src !== 'https://placehold.co/100x100/CCFBF1/0D9488?text=CG' && logoDisplay.src.startsWith('data:image')) {
                logoDataUrl = logoDisplay.src;
            }

            doc.setFontSize(18);
            let textYPosition = 22;
            let tableStartYPosition = 30;

            if (logoDataUrl) {
                try {
                    const imgProps = doc.getImageProperties(logoDataUrl);
                    const imgWidth = 20;
                    const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
                    // Add logo with some margin
                    doc.addImage(logoDataUrl, imgProps.format || 'PNG', 14, 15, imgWidth, imgHeight);
                    // Position text next to logo, vertically centered relative to logo space
                    doc.text("Caregiver Checklist", 14 + imgWidth + 5, 15 + (imgHeight / 2) + 3); // Adjust vertical alignment
                    // Ensure table starts below logo area
                    tableStartYPosition = 15 + imgHeight + 10;
                } catch (e) {
                    console.error("Error adding logo to PDF:", e);
                    doc.text("Caregiver Checklist", 14, textYPosition); // Fallback text position
                }
            } else {
                 doc.text("Caregiver Checklist", 14, textYPosition);
            }

            doc.setFontSize(11);
            doc.setTextColor(100);

            const tableColumn = ["Section", "Activity", "Who can help?", "When/How often?"];
            const tableRows = [];

            selectedItems.forEach(item => {
                const itemData = [
                    item.section,
                    item.activity,
                    item.help,
                    item.when
                ];
                tableRows.push(itemData);
            });

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: tableStartYPosition,
                theme: 'grid',
                headStyles: { fillColor: [13, 148, 136] }, // teal-600
                styles: { font: 'helvetica', fontSize: 10 },
            });
            doc.save('caregiver_checklist.pdf');
        });

        // Export to Word (.doc)
        document.getElementById('exportDoc').addEventListener('click', () => {
            const selectedItems = getSelectedItems();
            if (selectedItems.length === 0) {
                alert("No items selected to export.");
                return;
            }

            let logoHtml = '';
            if (logoDisplay.src && logoDisplay.src !== 'https://placehold.co/100x100/CCFBF1/0D9488?text=CG' && logoDisplay.src.startsWith('data:image')) {
                logoHtml = `<p style="text-align:center;"><img src="${logoDisplay.src}" alt="Logo" style="width:80px; height:auto; max-height:80px; border-radius:50%;"></p>`;
            }

            let htmlContent = `<html><head><meta charset='utf-8'><title>Caregiver Checklist</title>
                               <style> body { font-family: Arial, sans-serif; margin: 20px; }
                                       table { border-collapse: collapse; width: 100%; margin-bottom: 15px; font-size: 10pt; }
                                       th, td { border: 1px solid #cccccc; padding: 8px; text-align: left; vertical-align: top; } /* Added vertical-align */
                                       th { background-color: #F0FDFA; color: #0F766E; } /* Light Teal BG, Dark Teal Text */
                                       h1 { text-align: center; color: #0F766E; } /* Teal-700 */
                                       h2 { color: #115E59; margin-top: 20px; border-bottom: 1px solid #99D9D1; padding-bottom: 5px;} /* Teal-800, Teal-300 border */
                               </style></head><body>`;
            htmlContent += logoHtml;
            htmlContent += `<h1>Caregiver Checklist</h1>`;

            let currentSection = "";
            selectedItems.forEach(item => {
                if (item.section !== currentSection) {
                    if (currentSection !== "") htmlContent += "</tbody></table>";
                    currentSection = item.section;
                    htmlContent += `<h2>${currentSection}</h2>`;
                    htmlContent += `<table border="1">
                                        <thead>
                                            <tr>
                                                <th>Activity</th>
                                                <th>Who can help?</th>
                                                <th>When/How often?</th>
                                            </tr>
                                        </thead><tbody>`;
                }
                // Basic sanitation for Word export - replace potential HTML tags in user input
                const sanitize = (str) => String(str || '').replace(/</g, "&lt;").replace(/>/g, "&gt;");
                htmlContent += `<tr>
                                    <td>${sanitize(item.activity)}</td>
                                    <td>${sanitize(item.help)}</td>
                                    <td>${sanitize(item.when)}</td>
                                </tr>`;
            });
            if (currentSection !== "") htmlContent += "</tbody></table>";

            htmlContent += `</body></html>`;

            const blob = new Blob(['\ufeff', htmlContent], {
                type: 'application/msword'
            });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'caregiver_checklist.doc';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Export to Excel (.csv)
        document.getElementById('exportCsv').addEventListener('click', () => {
            const selectedItems = getSelectedItems();
            if (selectedItems.length === 0) {
                alert("No items selected to export.");
                return;
            }

            let csvContent = "Section,Activity,Who can help?,When/How often?\n";
            selectedItems.forEach(item => {
                const escapeCSV = (text) => `"${String(text || '').replace(/"/g, '""')}"`;
                csvContent += [
                    escapeCSV(item.section),
                    escapeCSV(item.activity),
                    escapeCSV(item.help),
                    escapeCSV(item.when)
                ].join(',') + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'caregiver_checklist.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Initial render of the checklist
        renderChecklist();
    </script>
</body>
</html>
